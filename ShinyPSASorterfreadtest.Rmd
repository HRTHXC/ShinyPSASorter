---
title: "ShinyPSASorterwFREAD ( test )"
author: "Harrison Crane"
github: "HRTHXC"
date: "12 December 2016"
output: html_document
---

```{r sampleCode, echo=FALSE, cache=FALSE}
library(stringr)
library(data.table)
library(plyr)
test <- fread(file.choose(), header = TRUE, data.table = TRUE)
testRowLength <- nrow(test)
rowBrCrCode <- ""
rowPlanted <- 0
rowPsaDeath <- 0
rowSurvival <- 0
for(i in 1:testRowLength){
  if(test$BrCrCode[i] == ""){
    test$BrCrCode[i] <- paste("PH_", i, sep = "")
    print(paste("hit found, turned nothing into ", test$BrCrCode[i], sep = ""))
  }
  slashCount <- str_count(test$BrCrCode[i], '/')
  if(slashCount == 1){
    print(paste("hit found, turn ", test$BrCrCode[i], " into ", unlist(strsplit(test$BrCrCode[i], split = '/', fixed=TRUE))[1], sep = ""))
    test$BrCrCode[i] <- unlist(strsplit(test$BrCrCode[i], split = '/', fixed=TRUE))[1]
  }
  else if(slashCount > 1){
    print(paste("control found, value ", test$BrCrCode[i], " into ", paste("control_", unlist(strsplit(test$BrCrCode[i], split = '/', fixed=TRUE))[1], sep = ""), sep = ""))
    test$BrCrCode[i] <- paste("control_", unlist(strsplit(test$BrCrCode[i], split = '/', fixed=TRUE))[1], sep = "")
  }
  underscoreCount <- str_count(test$BrCrCode[i], '_')
  if(underscoreCount == 0){
    print(paste("hit found, turn ", test$BrCrCode[i]," into ", as.character(str_extract(test$BrCrCode[i], "[aA-zZ]+")), "_",  as.numeric(str_extract(test$BrCrCode[i], "[0-9]+")), sep = "" ))
    #numLengthInXCode <- sapply(regmatches(test$BrCrCode[i], gregexpr("[:digit:]", test$BrCrCode[i])), length)
  }
  rowBrCrCode[i] <- test$BrCrCode[i]
  rowPlanted[i] <- as.numeric(test$Planted[i])
  rowPsaDeath[i] <- as.numeric(test$PsaDeath[i])
}
firstDT <- data.table(rowBrCrCode, rowPlanted, rowPsaDeath, rowSurvival)
firstDT <- aggregate(cbind(rowPlanted, rowPsaDeath, rowSurvival) ~ BrCrCode,
                   data = test, FUN = sum)
firstDT$rowSurvival <- 100 - ((firstDT$rowPsaDeath / firstDT$rowPlanted) * 100)
firstDT$rowSurvival <- format(round(firstDT$rowSurvival, 2), nsmall = 2)
print(firstDT)
```
