---
title: "ShinyPSASorterwFREAD ( v0.8 beta )"
author: "Harrison Crane"
github: "HRTHXC"
date: "12 December 2016"
output: html_document
---

```{r sampleCode, echo=FALSE, cache=FALSE}
library(stringr)
library(data.table)
library(plyr)
test <- fread(file.choose(), header = TRUE, data.table = TRUE)
testRowLength <- nrow(test)
rowBrCrCode <- ""
rowMother <- ""
rowFather <- ""
rowPlanted <- 0
rowPsaDeath <- 0
rowSurvival <- 0
splitCode <- ""
for(i in 1:testRowLength){
  if(test$BrCrCode[i] == ""){
    test$BrCrCode[i] <- paste("PH_", i, sep = "")
    print(paste("hit found, turned nothing into ", test$BrCrCode[i], sep = ""))
  }
  slashCount <- str_count(test$BrCrCode[i], '/')
  if(slashCount == 1){
    print(paste("hit found, turn ", test$BrCrCode[i], " into ", unlist(strsplit(test$BrCrCode[i], split = '/', fixed=TRUE))[1], sep = ""))
    test$BrCrCode[i] <- unlist(strsplit(test$BrCrCode[i], split = '/', fixed=TRUE))[1]
  }
  else if(slashCount > 1){
    print(paste("control found, value ", test$BrCrCode[i], " into ", paste("control_", unlist(strsplit(test$BrCrCode[i], split = '/', fixed=TRUE))[1], sep = ""), sep = ""))
    test$BrCrCode[i] <- paste("control_", unlist(strsplit(test$BrCrCode[i], split = '/', fixed=TRUE))[1], sep = "")
  }
  underscoreCount <- str_count(test$BrCrCode[i], '_')
  if(underscoreCount == 0){
    print(paste("hit found, turn ", test$BrCrCode[i]," into ", as.character(str_extract(test$BrCrCode[i], "[aA-zZ]+")), "_",  as.numeric(str_extract(test$BrCrCode[i], "[0-9]+")), sep = "" ))
    test$BrCrCode[i] <- paste(as.character(str_extract(test$BrCrCode[i], "[aA-zZ]+")), "_",  as.numeric(str_extract(test$BrCrCode[i], "[0-9]+")), sep = "")
  }
  rowBrCrCode[i] <- test$BrCrCode[i]
  splitCode <- strsplit(rowBrCrCode[i], "_")
  rowMother[i] <- sapply(splitCode, "[", 1)
  rowFather[i] <- sapply(splitCode, "[", 2)
  rowPlanted[i] <- as.numeric(test$Planted[i])
  rowPsaDeath[i] <- as.numeric(test$PsaDeath[i])
}
print(rowMother)
print(rowFather)
firstDT <- data.table(rowBrCrCode, rowPlanted, rowPsaDeath, rowSurvival)
motherDT <- data.table(rowMother, rowPlanted, rowPsaDeath, rowSurvival)
fatherDT <- data.table(rowFather, rowPlanted, rowPsaDeath, rowSurvival)
firstDT <- aggregate(cbind(rowPlanted, rowPsaDeath, rowSurvival) ~ BrCrCode, data = test, FUN = sum)
motherDT <- aggregate(cbind(rowPlanted, rowPsaDeath, rowSurvival) ~ rowMother, data = test, FUN = sum)
fatherDT <- aggregate(cbind(rowPlanted, rowPsaDeath, rowSurvival) ~ rowFather, data = test, FUN = sum)
firstDT$rowSurvival <- 100 - ((firstDT$rowPsaDeath / firstDT$rowPlanted) * 100)
motherDT$rowSurvival <- 100 - ((motherDT$rowPsaDeath / motherDT$rowPlanted) * 100)
fatherDT$rowSurvival <- 100 - ((fatherDT$rowPsaDeath / fatherDT$rowPlanted) * 100)
firstDT$rowSurvival <- format(round(firstDT$rowSurvival, 2), nsmall = 2)
motherDT$rowSurvival <- format(round(motherDT$rowSurvival, 2), nsmall = 2)
fatherDT$rowSurvival <- format(round(fatherDT$rowSurvival, 2), nsmall = 2)
print(firstDT)
print(motherDT)
print(fatherDT)
```
