---
title: "ShinyPSASorterwFREAD ( test )"
author: "Harrison Crane"
github: "HRTHXC"
date: "12 December 2016"
output: html_document
---

```{r sampleCode, echo=FALSE, cache=FALSE}
library(stringr)
library(data.table)
library(plyr)
test <- fread(file.choose(), header = TRUE, data.table = TRUE)
testRowLength <- nrow(test)
rowBrCrCode <- ""
rowPlanted <- 0
rowPsaDeath <- 0
rowSurvival <- 0
for(i in 1:testRowLength){
  if(test$BrCrCode[i] == ""){
    test$BrCrCode[i] <- paste("PH_", i, sep = "")
    print(paste("hit found, turned nothing into ", test$BrCrCode[i], sep = ""))
  }
  slashCount <- str_count(test$BrCrCode[i], '/')
  if(slashCount == 1){
    print(paste("hit found, turn ", test$BrCrCode[i], " into ", unlist(strsplit(test$BrCrCode[i], split = '/', fixed=TRUE))[1], sep = ""))
    test$BrCrCode[i] <- unlist(strsplit(test$BrCrCode[i], split = '/', fixed=TRUE))[1]
  }
  else if(slashCount > 1){
    print(paste("control found, value ", test$BrCrCode[i], " into ", paste("control_", unlist(strsplit(test$BrCrCode[i], split = '/', fixed=TRUE))[1], sep = ""), sep = ""))
    test$BrCrCode[i] <- paste("control_", unlist(strsplit(test$BrCrCode[i], split = '/', fixed=TRUE))[1], sep = "")
  }
  rowBrCrCode[i] <- test$BrCrCode[i]
  rowPlanted[i] <- test$Planted[i]
  rowPsaDeath[i] <- test$PsaDeath[i]
  #rowSurvival[i] <- 100 - (as.numeric(rowPsaDeath[i]) / as.numeric(rowPlanted[i]) * 100)
}
firstDT <- data.table(rowBrCrCode, rowPlanted, rowPsaDeath, rowSurvival)
print(firstDT)
firstDT_agg <- aggregate(. ~ rowBrCrCode, firstDT, FUM = sum(na.rm = TRUE))
#dt[, lapply(.SD, sum), by = rowBrCrCode]
#test2 <- aggregate(cbind(rowPlanted, rowPsaDeath, rowSurvival) ~ BrCrCode, data = test, FUN = sum) 
```
