---
title: "ShinyPSASorterInterim"
author: "Harrison Crane"
date: "5 December 2016"
output: html_document
---

```{r sampleCode}
test <- read.csv(file.choose(), header = TRUE)
rowCount <- nrow(test)
print(rowCount)
uniqueCouple <- levels(test[1, "BrCrCode"])
uniqueCoupleSize <- length(uniqueCouple)
print(uniqueCouple)
print(uniqueCoupleSize)
#split the string
testerSplit <- strsplit(levels(test[uniqueCouple, "BrCrCode"]), "[_]")
noquote(testerSplit)
#strip all father names (which are numbers)
fatherName <- as.numeric(gsub("\\D", "", testerSplit))
noquote(fatherName)
#count that length of numbers, for calculation later on
fatherLength <- nchar(fatherName[1])
noquote(fatherLength)
motherName <- as.character(gsub('[^[:alnum:]]', "",  testerSplit))
noquote(motherName)
motherLength <- nchar(motherName)
noquote(motherLength)
motherName <- substring(motherName, 2, (motherLength - fatherLength))
noquote(motherName)
motherName <- unique(motherName)
noquote(motherName)
fatherName <- unique(fatherName)
noquote(fatherName)
motherUniques <- length(motherName)
noquote(motherUniques)
fatherUniques <- length(fatherName)
noquote(fatherUniques)
visibleOutputDebug <- 0
endTablePrintout <- 0
overallUniques <- 1
for (i in 1:motherUniques){
  for (j in 1:fatherUniques){
    psaDeath <- 0
    planted <- 0
    lifeRate <- 0
    searching <- paste(motherName[i], fatherName[j], sep = "_")
    #print(searching)
    for (k in 1:rowCount){
      testingValue <- test[k, "BrCrCode"]
      #print(testingValue)
      if(searching == testingValue){
        psaDeath <- (psaDeath + test[k, "PsaDeaths"])
        planted <- (planted + test[k, "Planted"])
      }
    }
    #create a vector for me!
    lifeRate <- (100 - ((psaDeath / planted) * 100))
    lifeRate <- format(round(lifeRate, 2), nsmall = 2)
    #if we couldn't calculate an average before, ignore it
    if(planted == 0){
      visibleOutputDebug[overallUniques] <-  "NA"
    }
    #values under 40 are discarded, but still printed out (sample too small)
    else if(planted < 40 & !(planted == 0)){
      visibleOutputDebug[overallUniques] <- paste(lifeRate, "STS")
    }
    #otherwise, lets print it out, we can use the values later for calculating means
    else{
      visibleOutputDebug[overallUniques] <- lifeRate
    }
    overallUniques <- overallUniques + 1
  }
}
print(visibleOutputDebug)
print(motherUniques)
print(fatherUniques)
#endTablePrintout <- paste(endTablePrintout, '"')
#printoutLength <- nchar(endTablePrintout)
#print(printoutLength)
#endTablePrintout <- substring(endTablePrintout, 3, printoutLength)
#noquote(endTablePrintout)
#test with outputting to .csv
#write.csv(endTablePrintout, file="output.csv")
table <- matrix(visibleOutputDebug, nrow=motherLength-1, ncol=fatherLength-1, dimnames = list(fatherName, motherName))
noquote(table)
```